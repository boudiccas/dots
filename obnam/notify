#!/bin/bash
#: Title			: notify
#: Date				: October 2013
#: Author			: Sharon Kimble
#: Version			: 2.2
#: Description			: script to help in running obnam for backups
#: License			: GNU GPL 3.0 or later
####################################################
# How to use.
# Change the lines in the '#Variables' section to fit your situation and your file tree. And save it in ~/bin/notify, and then run 'chmod +x ~/bin/notify' to make it executable.
# Then put an entry for it in your crontab, this is mine -
# 00 */2 * * * DISPLAY=:0 /home/boudiccas/bin/notify	#backup /home and let it run every 2 hours for backups.
####################################################
# Variables
logfile="/home/boudiccas/logs/obnam.txt"
obconf="/home/boudiccas/cron/conf/obnam.conf"
obhome2="/media/boudiccas/backup/obnam-home2"
####################################################

notify-send "Starting main backup..."
# Log all stdout+stderr 
exec > >(tee -a $logfile) 2>&1

obnam --config="$obconf" backup

if [ "$?" -ne 0 ]; then
  notify-send "Unable to finish main backup."
  exit 1
else
  
  du -sh "$obhome2"
    
echo 'Sending Backup report : Backup to obnam-home2 completed', "$(date -R)" 'logged to' "$logfile"
echo '####################################'

  notify-send "Finished main backup."

fi
